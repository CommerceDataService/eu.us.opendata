<!DOCTYPE html>
<html>
  <meta charset="utf-8">
	<head>
    <script src="http://d3js.org/d3.v4.min.js"></script>
		<style>
		.node text {
			pointer-events: none;
			font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
		}
		</style>
	</head>
  <body>
    <script>
//stupid approach for now		
graph = {
  "nodes":[
    {"id":0, "name":"Maintainer","group":0, "catg":"human"},
    {"id":1, "name":"User","group":100, "catg":"human"},
    {"id":2, "name":"Linked_Open_Metadata_Store","group":1},
    {"id":3, "name":"Local_Metadata_Cache","group":1},
    {"id":4, "name":"CodeList_To_RDF","group":2},
    {"id":5, "name":"Dataflow_To_RDF","group":2},
    {"id":6, "name":"DSD_to_RDF","group":2},
    {"id":7, "name":"Harmonised_Dataset_To_RDF","group":3},
    {"id":8, "name":"Geo_GeoCode","group":3},
    {"id":9, "name":"Mappings_To_RDF","group":3, "catg":"beProc"},
    {"id":10,"name":"Create_RDF_Component_Map","group":4, "catg":"interfx"},
    {"id":11,"name":"Create_RDF_Structure_Map","group":4, "catg":"interfx"},
    {"id":12,"name":"Create_RDF_Value_Map","group":4, "catg":"interfx"},
    {"id":13,"name":"Create_RDF_Dataset","group":5, "catg":"interfx"},
    {"id":14,"name":"Create_RDF_DSD","group":5, "catg":"interfx"},
    {"id":15,"name":"large.query.handler","group":6, "catg":"interfx"},
    {"id":16,"name":"query.builder","group":6, "catg":"interfx"},
    {"id":17,"name":"Blank_ID","group":6, "catg":"interfx"},
    {"id":18,"name":"SDMX_To_RDF","group":7, "catg":"beProc"},
    {"id":19,"name":"BEA_To_RDF","group":7},
    {"id":20,"name":"Get_Dataset","group":8, "catg":"feProc"},
    {"id":21,"name":"List_Available_Datsets","group":8, "catg":"feProc"},
    {"id":22,"name":"Search_Dataset","group":8, "catg":"feProc"},
    {"id":23,"name":"Describe_Dataset","group":8, "catg":"feProc"},
    {"id":24,"name":"Dataset_Template","group":9, "catg":"csv"},
    {"id":25,"name":"DSD_Template","group":9, "catg":"csv"},
    {"id":26,"name":"Structure_Map_Template","group":10, "catg":"csv"},
    {"id":27,"name":"Component_Map_Template","group":10, "catg":"csv"},
    {"id":28,"name":"Value_Map_Template","group":10, "catg":"csv"},
    {"id":29,"name":"BEA_API","group":11, "catg":"http"},
    {"id":30,"name":"eurostat_API","group":11, "catg":"http"},
    {"id":31,"name":"beaSearch","group":12, "catg":"beaR"},
    {"id":32,"name":"beaGet","group":12, "catg":"beaR"},
    {"id":33,"name":"readSDMX","group":12, "catg":"rsdmx"},
    {"id":34,"name":"SPARQL","group":12, "catg":"SPARQL"}
  ],
 "links":[
    {"source":0,"target":19,"value":6},
    {"source":0,"target":7,"value":6},
    {"source":0,"target":8,"value":6},
    {"source":0,"target":9,"value":6},
    {"source":1,"target":20,"value":6},
    {"source":1,"target":21,"value":6},
    {"source":1,"target":22,"value":6},
    {"source":1,"target":23,"value":6},
	  {"source":2,"target":3,"value":3},
    {"source":3,"target":20,"value":3},
    {"source":3,"target":21,"value":3},
    {"source":3,"target":22,"value":3},
    {"source":3,"target":23,"value":3},
    {"source":29,"target":32,"value":2},
    {"source":30,"target":33,"value":2},
    {"source":29,"target":31,"value":2},
    {"source":20,"target":3,"value":1},
    {"source":21,"target":3,"value":1},
    {"source":22,"target":3,"value":1},
    {"source":23,"target":3,"value":1},
    {"source":18,"target":17,"value":1},
    {"source":18,"target":16,"value":1},
    {"source":18,"target":15,"value":1},
    {"source":18,"target":4,"value":1},
    {"source":18,"target":5,"value":1},
    {"source":18,"target":6,"value":1},
    {"source":18,"target":34,"value":1},
    {"source":18,"target":33,"value":1},
    {"source":7,"target":17,"value":1},
    {"source":7,"target":16,"value":1},
    {"source":7,"target":15,"value":1},
    {"source":7,"target":14,"value":1},
    {"source":7,"target":13,"value":1},
    {"source":25,"target":7,"value":1},
    {"source":24,"target":7,"value":1},
    {"source":9,"target":17,"value":1},
    {"source":9,"target":16,"value":1},
    {"source":9,"target":15,"value":1},
    {"source":9,"target":34,"value":1},
    {"source":9,"target":11,"value":1},
    {"source":9,"target":12,"value":1},
    {"source":9,"target":10,"value":1},
	  {"source":16,"target":16,"value":1},
    {"source":20,"target":32,"value":1},
    {"source":20,"target":33,"value":1},
    {"source":32,"target":29,"value":1},
    {"source":33,"target":30,"value":1},
    {"source":19,"target":31,"value":1},
    {"source":31,"target":29,"value":1},
    {"source":31,"target":3,"value":1},
    {"source":3,"target":31,"value":2},
    {"source":10,"target":3,"value":1},
    {"source":11,"target":3,"value":1},
    {"source":12,"target":3,"value":1},
    {"source":13,"target":3,"value":1},
    {"source":14,"target":3,"value":1},
    {"source":26,"target":9,"value":1},
    {"source":27,"target":9,"value":1},
    {"source":28,"target":9,"value":1},
    {"source":34,"target":2,"value":1}
  ]
}


// TODO - change node size and shape based on category

var width = 1000, height = 1300;

var color = d3.scaleOrdinal(d3.schemeCategory20);
//var color = d3.scale.category20();

// Append the SVG element to the body

var svg = d3.select('body')
	.append('svg')
	.attr("width", width)
	.attr("height", height)
	.style("border", "1px solid")
	

	
// Create a force-directed layout
var layout = d3.forceSimulation()
    .force("link", d3.forceLink().distance(200).strength(2))
    .force("charge", d3.forceManyBody())
    .force("center", d3.forceCenter(width / 2, height / 2));
			
	layout
		.nodes(graph.nodes);

  layout.force("link")
      .links(graph.links);
		
// Set the node and link arrays into the layout and start the layout
//	console.log(graph)
	var link = svg.selectAll("line")
		.data(graph.links)
		.enter().append("line")
			.attr("stroke", "grey")

			
	console.log(link)
		
	var node = svg.selectAll("circle")
		.data(graph.nodes)
		.enter().append("circle")
			.attr("r", 5)
//	    .attr("fill", function(d) { return color(d.id); })
// would rather use group for proximity and polygon? maybe not...
      .attr("fill", function(d) { return color(d.group); })
     .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

 	
	node.append("title")
		.text(function(d){return d.name});
	

var text = svg.append("g").attr("class", "labels").selectAll("g")
    .data(graph.nodes)
  .enter().append("g");

text.append("text")
    .attr("x", 14)
    .attr("y", ".31em")
    .style("font-family", "sans-serif")
    .style("font-size", "0.7em")
    .text(function(d) { return d.name; });

				
	console.log(node)
	

// Details: data from links array, fill strokes according to source

	link
		.attr("stroke", function(d) { 
//			console.log(d); 
			return color(d.source.group)
		})
		
		

	link
		.attr("stroke-width", function(d){return d.value})
		


layout.on("tick", function() {
  link.attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

 node.attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; });

    text
        .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })

});


function dragstarted(d) {
  if (!d3.event.active) layout.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) layout.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}


    </script>
  </body>
</html>